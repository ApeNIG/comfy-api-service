<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if default_tab == 'signup' %}Sign Up{% else %}Login{% endif %} - Creator</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: 'rgb(91, 127, 255)',
                    }
                }
            }
        }
    </script>

    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <style>
        /* Dot grid background pattern + gradients (matching landing page) */
        body {
            background-color: #0B0C0F;
            background-image:
                radial-gradient(ellipse at 30% 20%, rgba(91,127,255,0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 70% 60%, rgba(147,51,234,0.12) 0%, transparent 50%),
                radial-gradient(circle at 1px 1px, rgba(255,255,255,0.03) 1px, transparent 0);
            background-size: 100% 100%, 100% 100%, 40px 40px;
        }

        /* Glass effect (matching landing page) */
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Hide scrollbar but keep functionality */
        body::-webkit-scrollbar {
            width: 8px;
        }

        body::-webkit-scrollbar-track {
            background: transparent;
        }

        body::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }
    </style>
</head>
<body class="min-h-screen overflow-x-hidden text-white antialiased" x-data="authPage()">

    <!-- Header (matching landing page) -->
    <header class="relative z-20 px-8 py-8">
        <a href="/" class="text-2xl font-bold tracking-tight">CREATOR</a>
    </header>

    <!-- Main Container -->
    <div class="flex min-h-[calc(100vh-120px)] items-center justify-center px-6">
        <div class="w-full max-w-md">

            <!-- Glass Card -->
            <div class="glass rounded-3xl p-8 shadow-[0_20px_60px_rgba(0,0,0,.45)]">

                <!-- Logo/Title -->
                <div class="mb-8 text-center">
                    <h1 class="mb-2 text-3xl font-bold">
                        <span x-show="activeTab === 'login'">Welcome back</span>
                        <span x-show="activeTab === 'signup'">Create account</span>
                    </h1>
                    <p class="text-sm text-zinc-400">
                        <span x-show="activeTab === 'login'">Log in to continue to your dashboard</span>
                        <span x-show="activeTab === 'signup'">Get started with Creator today</span>
                    </p>
                </div>

                <!-- Tab Switcher -->
                <div class="mb-6 flex gap-2 rounded-xl bg-white/5 p-1.5 ring-1 ring-white/10">
                    <button
                        @click="activeTab = 'login'; errorMessage = ''; successMessage = ''"
                        :class="activeTab === 'login' ? 'bg-primary text-white shadow-[0_4px_14px_rgba(91,127,255,.4)]' : 'text-zinc-400 hover:text-white'"
                        class="flex-1 rounded-lg px-4 py-2.5 text-sm font-semibold transition"
                    >
                        Log In
                    </button>
                    <button
                        @click="activeTab = 'signup'; errorMessage = ''; successMessage = ''"
                        :class="activeTab === 'signup' ? 'bg-primary text-white shadow-[0_4px_14px_rgba(91,127,255,.4)]' : 'text-zinc-400 hover:text-white'"
                        class="flex-1 rounded-lg px-4 py-2.5 text-sm font-semibold transition"
                    >
                        Sign Up
                    </button>
                </div>

                <!-- Error Message -->
                <div x-show="errorMessage" x-transition class="mb-4 rounded-xl bg-red-500/10 px-4 py-3 text-sm text-red-300 ring-1 ring-red-500/20" x-text="errorMessage"></div>

                <!-- Success Message -->
                <div x-show="successMessage" x-transition class="mb-4 rounded-xl bg-green-500/10 px-4 py-3 text-sm text-green-300 ring-1 ring-green-500/20" x-text="successMessage"></div>

                <!-- Login Form -->
                <form x-show="activeTab === 'login'" @submit.prevent="handleLogin" x-transition>
                    <div class="mb-4">
                        <label for="login-email" class="mb-2 block text-sm font-medium text-zinc-300">Email</label>
                        <input
                            type="email"
                            id="login-email"
                            x-model="loginForm.email"
                            placeholder="you@example.com"
                            required
                            autocomplete="email"
                            class="w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-white placeholder-zinc-500 ring-primary/20 transition focus:border-primary/50 focus:outline-none focus:ring-2"
                        />
                    </div>

                    <div class="mb-6">
                        <label for="login-password" class="mb-2 block text-sm font-medium text-zinc-300">Password</label>
                        <input
                            type="password"
                            id="login-password"
                            x-model="loginForm.password"
                            placeholder="••••••••"
                            required
                            autocomplete="current-password"
                            class="w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-white placeholder-zinc-500 ring-primary/20 transition focus:border-primary/50 focus:outline-none focus:ring-2"
                        />
                    </div>

                    <button
                        type="submit"
                        :disabled="isLoading"
                        class="flex h-12 w-full items-center justify-center rounded-xl bg-primary text-base font-semibold text-white shadow-[0_10px_30px_rgba(91,127,255,.45)] transition hover:brightness-110 disabled:cursor-not-allowed disabled:opacity-60"
                    >
                        <span x-show="!isLoading">Log In</span>
                        <span x-show="isLoading" class="flex items-center gap-2">
                            <svg class="h-5 w-5 animate-spin" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            Logging in...
                        </span>
                    </button>
                </form>

                <!-- Signup Form -->
                <form x-show="activeTab === 'signup'" @submit.prevent="handleSignup" x-transition>
                    <div class="mb-4">
                        <label for="signup-name" class="mb-2 block text-sm font-medium text-zinc-300">Full Name <span class="text-zinc-500">(optional)</span></label>
                        <input
                            type="text"
                            id="signup-name"
                            x-model="signupForm.fullName"
                            placeholder="Jane Doe"
                            autocomplete="name"
                            class="w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-white placeholder-zinc-500 ring-primary/20 transition focus:border-primary/50 focus:outline-none focus:ring-2"
                        />
                    </div>

                    <div class="mb-4">
                        <label for="signup-email" class="mb-2 block text-sm font-medium text-zinc-300">Email</label>
                        <input
                            type="email"
                            id="signup-email"
                            x-model="signupForm.email"
                            placeholder="you@example.com"
                            required
                            autocomplete="email"
                            class="w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-white placeholder-zinc-500 ring-primary/20 transition focus:border-primary/50 focus:outline-none focus:ring-2"
                        />
                    </div>

                    <div class="mb-6">
                        <label for="signup-password" class="mb-2 block text-sm font-medium text-zinc-300">Password</label>
                        <input
                            type="password"
                            id="signup-password"
                            x-model="signupForm.password"
                            placeholder="At least 8 characters"
                            required
                            minlength="8"
                            autocomplete="new-password"
                            class="w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-white placeholder-zinc-500 ring-primary/20 transition focus:border-primary/50 focus:outline-none focus:ring-2"
                        />
                    </div>

                    <button
                        type="submit"
                        :disabled="isLoading"
                        class="flex h-12 w-full items-center justify-center rounded-xl bg-primary text-base font-semibold text-white shadow-[0_10px_30px_rgba(91,127,255,.45)] transition hover:brightness-110 disabled:cursor-not-allowed disabled:opacity-60"
                    >
                        <span x-show="!isLoading">Create Account</span>
                        <span x-show="isLoading" class="flex items-center gap-2">
                            <svg class="h-5 w-5 animate-spin" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            Creating account...
                        </span>
                    </button>
                </form>

                <!-- Footer Link -->
                <div class="mt-6 text-center">
                    <p class="text-sm text-zinc-400">
                        <span x-show="activeTab === 'login'">Don't have an account? </span>
                        <span x-show="activeTab === 'signup'">Already have an account? </span>
                        <button
                            @click="activeTab = activeTab === 'login' ? 'signup' : 'login'; errorMessage = ''; successMessage = ''"
                            class="font-semibold text-primary hover:brightness-110"
                        >
                            <span x-show="activeTab === 'login'">Sign up</span>
                            <span x-show="activeTab === 'signup'">Log in</span>
                        </button>
                    </p>
                </div>

            </div>

        </div>
    </div>

    <!-- Alpine.js Component -->
    <script>
        function authPage() {
            return {
                // State
                activeTab: '{{ default_tab or "login" }}',
                isLoading: false,
                errorMessage: '',
                successMessage: '',

                // Forms
                loginForm: {
                    email: '',
                    password: '',
                },
                signupForm: {
                    fullName: '',
                    email: '',
                    password: '',
                },

                // Handle Login
                async handleLogin() {
                    this.isLoading = true;
                    this.errorMessage = '';
                    this.successMessage = '';

                    try {
                        const response = await fetch('/auth/login', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                email: this.loginForm.email,
                                password: this.loginForm.password,
                            }),
                        });

                        const data = await response.json();

                        if (response.ok) {
                            // Store token in localStorage
                            localStorage.setItem('access_token', data.access_token);

                            // Set cookie for server-side rendering (7 days)
                            document.cookie = `access_token=${data.access_token}; path=/; max-age=604800; SameSite=Lax`;

                            this.successMessage = data.message || 'Login successful!';

                            // Redirect after short delay
                            setTimeout(() => {
                                window.location.href = data.next_step || '/dashboard';
                            }, 1000);
                        } else {
                            // Show error
                            this.errorMessage = data.detail?.message || data.detail || 'Login failed. Please check your credentials.';
                            this.isLoading = false;
                        }
                    } catch (error) {
                        console.error('Login error:', error);
                        this.errorMessage = 'Something went wrong. Please try again.';
                        this.isLoading = false;
                    }
                },

                // Handle Signup
                async handleSignup() {
                    this.isLoading = true;
                    this.errorMessage = '';
                    this.successMessage = '';

                    try {
                        const response = await fetch('/auth/register', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                email: this.signupForm.email,
                                password: this.signupForm.password,
                                full_name: this.signupForm.fullName || null,
                            }),
                        });

                        const data = await response.json();

                        if (response.ok) {
                            // Store token in localStorage
                            localStorage.setItem('access_token', data.access_token);

                            // Set cookie for server-side rendering (7 days)
                            document.cookie = `access_token=${data.access_token}; path=/; max-age=604800; SameSite=Lax`;

                            this.successMessage = data.message || 'Account created successfully!';

                            // Redirect after short delay
                            setTimeout(() => {
                                window.location.href = data.next_step || '/onboarding';
                            }, 1500);
                        } else {
                            // Show error
                            this.errorMessage = data.detail?.message || data.detail || 'Signup failed. Please try again.';
                            this.isLoading = false;
                        }
                    } catch (error) {
                        console.error('Signup error:', error);
                        this.errorMessage = 'Something went wrong. Please try again.';
                        this.isLoading = false;
                    }
                },
            }
        }
    </script>
</body>
</html>
